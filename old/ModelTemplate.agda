
module ModelTemplate where

open import Lib hiding (id; _∘_)
open import Syntax using (PS; P; S)

infixl 7 _[_]T
infixl 5 _,s_
infix  6 _∘_
infixl 8 _[_]t
infixl 3 _▶_

postulate
  i : Level
  j : Level

  Con : Set i
  Ty  : Con → PS → Set i
  Tm  : ∀ Γ → ∀ {k} → Ty Γ k → Set j
  Sub : Con → Con → Set j

  ∙     : Con
  _▶_   : ∀{k}(Γ : Con) → Ty Γ k → Con

  _[_]T : ∀{k Γ Δ} → Ty Δ k → Sub Γ Δ → Ty Γ k

  id    : ∀{Γ} → Sub Γ Γ
  _∘_   : ∀{Γ Δ Σ} → Sub Δ Σ → Sub Γ Δ → Sub Γ Σ
  ε     : ∀{Γ} → Sub Γ ∙
  _,s_  : ∀{k Γ Δ}(σ : Sub Γ Δ){A : Ty Δ k} → Tm Γ (A [ σ ]T) → Sub Γ (Δ ▶ A)
  π₁    : ∀{k Γ Δ}{A : Ty Δ k} → Sub Γ (Δ ▶ A) → Sub Γ Δ

  _[_]t : ∀{k Γ Δ}{A : Ty Δ k} → Tm Δ A → (σ : Sub Γ Δ) → Tm Γ (A [ σ ]T)
  π₂    : ∀{k Γ Δ}{A : Ty Δ k}(σ : Sub Γ (Δ ▶ A)) → Tm Γ (A [ π₁ σ ]T)

  [id]T : ∀{k Γ}{A : Ty Γ k} → A [ id ]T ≡ A
  [][]T : ∀{k Γ Δ Σ}{A : Ty Σ k}{σ : Sub Γ Δ}{δ : Sub Δ Σ}
          → A [ δ ]T [ σ ]T ≡ A [ δ ∘ σ ]T

  idl   : ∀{Γ Δ}{σ : Sub Γ Δ} → (id ∘ σ) ≡ σ
  idr   : ∀{Γ Δ}{σ : Sub Γ Δ} → (σ ∘ id) ≡ σ
  ass   : ∀{Γ Δ Σ Ω}{σ : Sub Σ Ω}{δ : Sub Δ Σ}{ν : Sub Γ Δ}
        → (σ ∘ δ) ∘ ν ≡ σ ∘ (δ ∘ ν)

  ,∘    : ∀{k Γ Δ Σ}{δ : Sub Γ Δ}{σ : Sub Σ Γ}{A : Ty Δ k}{t : Tm Γ (A [ δ ]T)}
        → ((δ ,s t) ∘ σ) ≡ ((δ ∘ σ) ,s tr (Tm Σ) [][]T (t [ σ ]t))
  π₁β   : ∀{k Γ Δ}{A : Ty Δ k}{σ : Sub Γ Δ}{t : Tm Γ (A [ σ ]T)}
        → (π₁ (σ ,s t)) ≡ σ
  πη    : ∀{k Γ Δ}{A : Ty Δ k}{σ : Sub Γ (Δ ▶ A)}
        → (π₁ σ ,s π₂ σ) ≡ σ
  εη    : ∀{Γ}{σ : Sub Γ ∙}
        → σ ≡ ε
  π₂β   : ∀{k Γ Δ}{A : Ty Δ k}{σ : Sub Γ Δ}{t : Tm Γ (A [ σ ]T)}
        → π₂ (σ ,s t) ≡ tr (λ σ → Tm Γ (A [ σ ]T)) (π₁β ⁻¹) t

wk : ∀{k Γ}{A : Ty Γ k} → Sub (Γ ▶ A) Γ
wk = π₁ id

vz : ∀{k Γ}{A : Ty Γ k} → Tm (Γ ▶ A) (A [ wk ]T)
vz = π₂ id

vs : ∀{k Γ}{A B : Ty Γ k} → Tm Γ A → Tm (Γ ▶ B) (A [ wk ]T)
vs x = x [ wk ]t

<_> : ∀{k Γ}{A : Ty Γ k} → Tm Γ A → Sub Γ (Γ ▶ A)
< t > = id ,s tr (Tm _) ([id]T ⁻¹) t

infix 4 <_>

_^_ : ∀ {k}{Γ Δ : Con}(σ : Sub Γ Δ)(A : Ty Δ k) → Sub (Γ ▶ (A [ σ ]T)) (Δ ▶ A)
_^_ {k}{Γ} {Δ} σ A = σ ∘ wk ,s coe (Tm _ & [][]T) (vz {k}{Γ}{A [ σ ]T})

infixl 5 _^_


-- Universe
--------------------------------------------------------------------------------

postulate
  U    : ∀{Γ} → Ty Γ S
  U[]  : ∀{Γ Δ}{σ : Sub Γ Δ} → (U [ σ ]T) ≡ U
  El   : ∀{Γ}(a : Tm Γ U) → Ty Γ P
  El[] : ∀{Γ Δ}{σ : Sub Γ Δ}{a : Tm Δ U}
       → (El a [ σ ]T) ≡ (El (coe (Tm Γ & U[]) (a [ σ ]t)))

-- Inductive functions
--------------------------------------------------------------------------------
postulate
  Π : ∀{k Γ}(a : Tm Γ U)(B : Ty (Γ ▶ El a) k) → Ty Γ k

  Π[] :
    {k : PS} {Γ Δ : Con} {σ : Sub Γ Δ} {a : Tm Δ {S} (U {Δ})} {B : Ty
    (_▶_ {P} Δ (El {Δ} a)) k} → _≡_ {i} {Ty Γ k} (_[_]T {k} {Γ}
    {Δ} (Π {k} {Δ} a B) σ) (Π {k} {Γ} (tr {i} {j} {Ty Γ S} (Tm Γ
    {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ})
    (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ)) (tr {i} {i} {Ty Γ P} (λ x →
    Ty (_▶_ {P} Γ x) k) {_[_]T {P} {Γ} {Δ} (El {Δ} a) σ} {El {Γ}
    (tr {i} {j} {Ty Γ S} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ}
    {U {Γ}} (U[] {Γ} {Δ} {σ}) (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ))}
    (El[] {Γ} {Δ} {σ} {a}) (_[_]T {k} {_▶_ {P} Γ (_[_]T {P} {Γ}
    {Δ} (El {Δ} a) σ)} {_▶_ {P} Δ (El {Δ} a)} B (_^_ {P} {Γ} {Δ} σ
    (El {Δ} a)))))

  app : ∀{k Γ}{a : Tm Γ U}{B : Ty (Γ ▶ El a) k} → Tm Γ (Π a B) → Tm (Γ ▶ El a) B

  app[] :
       {k : PS} {Γ Δ : Con} {σ : Sub Γ Δ} {a : Tm Δ {S} (U {Δ})} {B : Ty (_▶_
       {P} Δ (El {Δ} a)) k} {t : Tm Δ {k} (Π {k} {Δ} a B)} → _≡_ {j} {Tm (_▶_
       {P} Γ (El {Γ} (coe {j} {Tm Γ {S} (_[_]T {S} {Γ} {Δ} (U {Δ}) σ)} {Tm Γ
       {S} (U {Γ})} (_&_ {i} {suc j} {Ty Γ S} {Set j} (Tm Γ {S}) {_[_]T {S}
       {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ})) (_[_]t {S} {Γ} {Δ} {U
       {Δ}} a σ)))) {k} (tr {i} {i} {Ty Γ P} (λ z → Ty (_▶_ {P} Γ z) k)
       {_[_]T {P} {Γ} {Δ} (El {Δ} a) σ} {El {Γ} (coe {j} {Tm Γ {S} (_[_]T {S}
       {Γ} {Δ} (U {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j} {Ty Γ S} {Set
       j} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ}))
       (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ))} (El[] {Γ} {Δ} {σ} {a}) (_[_]T {k}
       {_▶_ {P} Γ (_[_]T {P} {Γ} {Δ} (El {Δ} a) σ)} {_▶_ {P} Δ (El {Δ} a)} B
       (_^_ {P} {Γ} {Δ} σ (El {Δ} a))))} (tr2 {i} {i} {j} {Ty Γ P} {λ z → Ty
       (_▶_ {P} Γ z) k} (λ A → Tm (_▶_ {P} Γ A) {k}) {_[_]T {P} {Γ} {Δ} (El
       {Δ} a) σ} {El {Γ} (coe {j} {Tm Γ {S} (_[_]T {S} {Γ} {Δ} (U {Δ}) σ)}
       {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j} {Ty Γ S} {Set j} (Tm Γ {S}) {_[_]T
       {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ})) (_[_]t {S} {Γ} {Δ}
       {U {Δ}} a σ))} (El[] {Γ} {Δ} {σ} {a}) {_[_]T {k} {_▶_ {P} Γ (_[_]T {P}
       {Γ} {Δ} (El {Δ} a) σ)} {_▶_ {P} Δ (El {Δ} a)} B (_^_ {P} {Γ} {Δ} σ (El
       {Δ} a))} {tr {i} {i} {Ty Γ P} (λ z → Ty (_▶_ {P} Γ z) k) {_[_]T {P}
       {Γ} {Δ} (El {Δ} a) σ} {El {Γ} (coe {j} {Tm Γ {S} (_[_]T {S} {Γ} {Δ} (U
       {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j} {Ty Γ S} {Set j} (Tm Γ
       {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ})) (_[_]t
       {S} {Γ} {Δ} {U {Δ}} a σ))} (El[] {Γ} {Δ} {σ} {a}) (_[_]T {k} {_▶_ {P}
       Γ (_[_]T {P} {Γ} {Δ} (El {Δ} a) σ)} {_▶_ {P} Δ (El {Δ} a)} B (_^_ {P}
       {Γ} {Δ} σ (El {Δ} a)))} refl (_[_]t {k} {_▶_ {P} Γ (_[_]T {P} {Γ} {Δ}
       (El {Δ} a) σ)} {_▶_ {P} Δ (El {Δ} a)} {B} (app {k} {Δ} {a} {B} t) (_^_
       {P} {Γ} {Δ} σ (El {Δ} a)))) (app {k} {Γ} {coe {j} {Tm Γ {S} (_[_]T {S}
       {Γ} {Δ} (U {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j} {Ty Γ S} {Set
       j} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[] {Γ} {Δ} {σ}))
       (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ)} {tr {i} {i} {Ty Γ P} (λ z → Ty (_▶_
       {P} Γ z) k) {_[_]T {P} {Γ} {Δ} (El {Δ} a) σ} {El {Γ} (coe {j} {Tm Γ
       {S} (_[_]T {S} {Γ} {Δ} (U {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j}
       {Ty Γ S} {Set j} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[]
       {Γ} {Δ} {σ})) (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ))} (El[] {Γ} {Δ} {σ} {a})
       (_[_]T {k} {_▶_ {P} Γ (_[_]T {P} {Γ} {Δ} (El {Δ} a) σ)} {_▶_ {P} Δ (El
       {Δ} a)} B (_^_ {P} {Γ} {Δ} σ (El {Δ} a)))} (tr {i} {j} {Ty Γ k} (Tm Γ
       {k}) {_[_]T {k} {Γ} {Δ} (Π {k} {Δ} a B) σ} {Π {k} {Γ} (coe {j} {Tm Γ
       {S} (_[_]T {S} {Γ} {Δ} (U {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_ {i} {suc j}
       {Ty Γ S} {Set j} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ} {U {Γ}} (U[]
       {Γ} {Δ} {σ})) (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ)) (tr {i} {i} {Ty Γ P} (λ
       z → Ty (_▶_ {P} Γ z) k) {_[_]T {P} {Γ} {Δ} (El {Δ} a) σ} {El {Γ} (coe
       {j} {Tm Γ {S} (_[_]T {S} {Γ} {Δ} (U {Δ}) σ)} {Tm Γ {S} (U {Γ})} (_&_
       {i} {suc j} {Ty Γ S} {Set j} (Tm Γ {S}) {_[_]T {S} {Γ} {Δ} (U {Δ}) σ}
       {U {Γ}} (U[] {Γ} {Δ} {σ})) (_[_]t {S} {Γ} {Δ} {U {Δ}} a σ))} (El[] {Γ}
       {Δ} {σ} {a}) (_[_]T {k} {_▶_ {P} Γ (_[_]T {P} {Γ} {Δ} (El {Δ} a) σ)}
       {_▶_ {P} Δ (El {Δ} a)} B (_^_ {P} {Γ} {Δ} σ (El {Δ} a))))} (Π[] {k}
       {Γ} {Δ} {σ} {a} {B}) (_[_]t {k} {Γ} {Δ} {Π {k} {Δ} a B} t σ)))
